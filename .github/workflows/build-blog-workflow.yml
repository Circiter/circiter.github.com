name: build-blog-workflow

on:
  push:
    branches:
      - source

jobs:
  checkout-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master

    # TODO: Consider to cache .bundle, /tmp/texlive/, $HOME/.texlive.
    #- name: Cache some files
    #  uses: actions/cache@v1
    #  with:
    #    path: ~/.npm
    #    key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
    #    restore-keys: |
    #      ${{ runner.os }}-build-${{ env.cache-name }}-
    #      ${{ runner.os }}-build-
    #      ${{ runner.os }}-

    - name: Build jekyll site
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BASE_BRANCH: source
        BRANCH: master
        CNAME: circiter.tk
        FOLDER: _site
      uses: ./.github/actions/build-blog-action
