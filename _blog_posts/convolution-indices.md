---
layout: post
title: "Индексы в определении свертки последовательностей [или функций]."
tags: математика, trivia
toc: true
sig: true
---

-----------------------------

<center>**Аннотация**</center>

Попытка объяснения необычных индексов в определении операции свёртки.

-----------------------------

# Введение

Что общего между поиском котов на фотографии, сжатием музыки, прогнозированнием курсов валют,
угадыванием мелодии по нотам, умножением чисел на бумаге (или на счётах), и добавлением,
скажем, эффекта звучания в большом железобетонном зале к речи, записанной на улице?

А общность их заключена хотя-бы в том, что с точки зрения программиста, все эти задачи (причем,
список подобных --- на первый взгляд разрозненных --- примеров на самом деле длиннее) могут быть
более или менее успешно решены практически одним и тем же небольшим куском кода, реализующим свёртку
функций или последовательностей. (С точки зрения же заказчиков и управляющих/начальства этого
программиста, такие задачи должны, конечно, считаться абсолютно не связанными друг с другом и,
соответственно, требующими отдельного независимого финансирования. :) )

Взглянув на первое попавшееся определение свертки, некоторым нелегко сразу понять, почему в формуле
записаны минусы в индексах, и почему при наглядной интерпретации в виде наложения графиков требуется
сначала отразить один из них.

В настоящем сообщении я хотел бы показать естественность свертки используя ряд простых примеров,
среди которых будут перемножение чисел, теорема о свертке и рассуждения о сдвиговой инвариантности
линейных преобразований.

# Немного определений

Циклической (или круговой) свёрткой двух последовательностей $a_i$ и $b_i$ длины $n$ называют
$n$-элементную последовательность $h=a\ast b$ с элементами
$$h_i=\sum\limits_{j=0}^{n-1} a_j b_{(i-j)\mod n}.\eqno (1)$$

Выражение (1) может быть записано и более симметричным образом (обратите внимание, что такая запись
уже позволяет избавиться от минусов, правда ценой переноса слагаемого в индекс/предел суммы):
$$h_i=\sum_{j+k\equiv i\pmod n} a_j b_k.\eqno (2)$$

**Теорема о свертке:**
$$a\ast b=\mathcal{F}^{-1}\Big[\mathcal{F}[a]\cdot\mathcal{F}[b]\Big],$$ где
$\mathcal{F}$ -- преобразование Фурье; причем перемножение Фурье-образов производится поэлементно.

В словесной формулировке можно сказать, что спектр свертки равен произведению
спектров исходных сигналов.

**Набросок доказательства (из [3]):**
{% tex block %}
\begin{align*}
\mathcal{F}[a]_k\cdot\mathcal{F}[b]_k&=\sum_x a_x z^{kx} \sum_y b_y z^{ky}=\\
&=\sum_x a_x z^{kz} \sum_{\tau-x} b_{\tau-x}z^{k(\tau-x)}=\left[y=\tau-x\right]=\\
&=\sum_x\sum_{\tau-x} a_x z^{kx} b_{\tau-x} z^{k(\tau-x)}=\sum_\tau\left(
\sum_x a_x b_{\tau-x}\right)z^{k\tau}=\\
&=\left(\mathcal{F}\left[\sum_x a_x b_{\tau-x}\right]\right)_k=
\left(\mathcal{F}[a\ast b]\right)_k,
\end{align*}
{% endtex %}
где $z\equiv\exp(\sigma 2\pi i/n)$ и используется определение преобразования Фурье для
последовательности: $\mathcal{F}[a]_k=\sum_x a_x z^{kx}$ (здесь игнорируется небольшое отличие
между прямым и обратным преобразованиями Фурье, заключающееся в знаке аргумента экспоненты и
в множителе $1/n$ [перед обратным преобразованием]). $\blacksquare$

Аналогичный результат известен и для преобразования Лапласа:
$\mathcal{L}[x(t)\ast h(t)]=\mathcal{L}[x(t)]\cdot\mathcal{L}[h(t)]$.

Уместно заметить, что теорема о свертке имеет важное прикладное значение, т.к. дает
метод эффективного вычисления свертки с помощью быстрого преобразования Фурье [4]. В нашем
же случае важно видеть как в приведенном простом доказательстве появляются минусы в индексах и,
что гораздо более интересно, как они используются далее для преобразования границ суммирования.

Линейной (или ацикличной) свёрткой $n$-элементных последовательностей $a$ и $b$ называется
последовательность $h=a\ast_\mathrm{lin} b$ длины $2n$, с элементами:
$$h_i=\sum_{j=0}^{2n-1} a_j b_{i-j}.\eqno (3)$$

Линейная свертка может быть найдена с помощью циклической свертки если исходные последовательности
длины $n$ дополнить нулями до длины $2n$, а затем свернуть.

Линейная свертка фактически может рассматриваться как произведение чисел --- суть строк
цифр [в некоторой позиционной системе счисления], --- или как произведение полиномов.

Определение свертки обобщается и на непрерывный случай. А именно, если $f(x)$ и $g(x)$ -- непрерывные
функции, то их свертка равна
$$f(x)\ast g(x)=\int\limits_{-\infty}^\infty f(y)g(x-y)\mathrm{d}y.$$

N.B., этот интеграл тоже является функцией от $x$. (Вопросы, связанные с квадратичной интегрируемостью
функций $f$ и $g$ здесь не рассматриваются.)

# Умножение чисел

Перемножим два целых положительных числа $a$ и $b$, имеющих десятичные разложения
$a=\sum_{i=0}^na_i10^i$ и
$b=\sum_{i=0}^mb_i10^j$,
соответственно, где $a_i, b_i\in[0;9]\subset\mathbb{N}$. Результат будет равен
$$c=ab=\sum_i\sum_j a_ib_j 10^{i+j}.\eqno (4)$$

Но если мы построим подобное разложение и для $c$, т.е. запишем его как
$$c=\sum_{k=0} c_k 10^k,\eqno (5)$$ где $0\leq c_k\in\mathbb{N}$ (N.B., здесь, в отличии от разложений
для $a$ и $b$ мы не используем неравенство $c_k<10$, позволяя такой записи числа оставаться
<<ненормализованной>>, т.е. возможно требующей серии дальнейших переносов в старший разряд),
то приравнивая (4) и (5) мы получим выражения для <<цифр>> числа $c$:
$$c_k=\sum_{i, j:\ i+j=k}a_ib_j,$$ где применено равенство $i+j=k$ из-за того, что в слагаемом
$a_ib_j10^{i+j}$ разложения (4) множитель $a_ib_j$ находится при степени десяти $10^{i+j}$,
а $c_k$ в разложении (5) находится при $10^k$.

Из $i+j=k$ можно выразить $i$ как $i=k-j$. Подстановка в выражения для $c_k$ дает:
$$c_k=\sum_{j=0}^k a_{k-j}b_j,\ 0\leq k\leq n+m.\eqno (6)$$

Сравнение (6) с (3) показывает, что мы здесь имеем дело именно с линейной сверткой
последовательностей цифр исходных чисел $a$ и $b$. (Достаточное количество переносов в старший разряд,
выполненных в произвольном порядке, позволит преобразовать каждое $c_k$ в
$c'_k\in[0; 9]\subset\mathbb{N}$, т.е. в настоящую цифру числа
$c=ab=\sum_{k=0}^{n+m} c'_k10^k$.)

# Корреляция

Для непрерывных функций $f$ и $g$, их корреляция (или кросс-корреляция) определяется как
$$(f\star g)(x)\equiv\int\limits_{-\infty}^\infty \overline{f(y-x)}g(y)\mathrm{d}y.$$

($\overline{x}$ обозначает комплексное сопряжение некоторого числа $x\in\mathbb{C}$.)

Это определение можно записать в эквивалентной форме, без минуса:
$$(f\star g)(x)\equiv\int\limits_{-\infty}^\infty \overline{f(y)}g(y+x)\mathrm{d}y.$$

Если $f$ и $g$ периодичны с периодом $T$, то можно интегрирование производить по
интервалу $[t, t+T],\ \forall t$.

Связь корреляции со сверткой:
$$\left(f(x)\star g(x)\right)(x)=\left(\overline{f(-x)}\ast g(x)\right)(x).$$

Интересное свойство:
$$f\star(g\ast h)=(f\star g)\ast h.$$

Аналог теоремы о свертке; привожу без доказательства (которое, однако, легко построить
по аналогии с вышеприведенным случаем для обычной теоремы о свертке):
$$\mathcal{F}[f\star g]=\overline{\mathcal{F}[f]}\cdot\mathcal{F}[g].$$

Также как и в случае со сверткой, мы можем ограничиться рассмотрением значений функций в
отдельных точках, что после замены интегралов знаками суммы приводит к аналогичным формулам
для числовых последовательностей.

# Линейные системы

Широкое практическое применение свертки (в частности физиками и инженерами) обусловленно возможностью
её использования для описания отклика линейных систем, в том числе многих реальных физических систем,
обладающих свойствами линейности и сдвиговой инвариантности (симметричности) по времени (или
заменяющей(-им) его переменной(-ым)).

(Ниже, в основном, приведена свободная адаптация материала из [5] с некоторым упрощением нотации, и
не факт, что без ущерба строгости изложения. Кроме того, я ограничусь рассмотрением только
непрерывного случая, подразумевая, что дискретная версия вытекает из него как частный случай.)

Допустим, некоторая система моделируется функцией $F_t$, преобразующей входной сигнал $x(u)$ в отклик
$X(t)=F_t x(u)$. Отображение $F_t$ (фактически, оператор) линейно:
$F_t\big(\alpha_1 x_1(u)+\alpha_2 x_2(u)\big)=\alpha_1 F_t x_1(u)+\alpha_2 F_t x_2(t)$.
Последнее выражение, очевидно, легко обобщается и на произвольное количество слагаемых-сигналов
$x_\tau(u)$ и на непрерывный случай с заменой суммирования
интегрированием: $$F_t\int\limits_{-\infty}^\infty \alpha_\tau x_\tau(u)\mathrm{d}\tau=
\int\limits_{-\infty}^\infty \alpha_\tau X_\tau(t)\mathrm{d}\tau,\eqno (7)$$ где $F_t$ преобразует
$x_\tau(u)$ в $X_\tau(t)$.

Кроме этого, отображение $F_t$ инвариантно относительно сдвигов [по <<времени>>]:
$$x(u-\tau)\mapsto X(t-\tau)=F_t x(u-\tau).\eqno (8)$$ Т.е. в данном случае моделируется
важное свойство реальных систем, а именно независимость результатов эксперимента от времени его
начала: если мы опоздали с началом эксперимента на некоторое время $\tau$, то и результаты мы получим
с опозданием $\tau$.

Так как $X(t)=F_t x(u)$, то (просто за счет подстановки $t\mapsto t-\tau$)
$$X(t-\tau)=F_{t-\tau}x(u).\eqno (9)$$

Если в качестве сигнала взять [одномерную] дельта-функцию Дирака $\delta(u)$ [6, 7], равную нулю
всюда за исключением единственной точки $u=0$ (в которой она равна бесконечности) и моделирующую
идеальный импульс [бесконечно малой продолжительности], то с помощью $F_t$ мы получим импульсный
отклик $h(t)=F_t\delta(u)$.

Это выражение с использованием уравнений (8) и (9) приводит к
$$h(t-\tau)=F_{t-\tau}\delta(u)=F_t \delta(u-\tau).\eqno (10)$$

Интересно, что несмотря на <i>de-facto</i> определение
$$\delta(u)=\begin{cases}+\infty, & u=0\\0,\end{cases}$$ интеграл по всему пространству равен 1:
$$\int\limits_{-\infty}^\infty\delta(u)\mathrm{d}u=1.$$ Причем из этого уравнения следует
<i>фильтрующее свойство</i> $\delta$-функции (для некоторой функции $f$):
$$\int\limits_{-\infty}^\infty f(\tau)\delta(u-\tau)\mathrm{d}\tau=f(u).\eqno (11)$$

**Доказательство фильтрующего свойства.**

Т.к. $\delta(u-\tau)=0$ при $\tau\neq u$, то интеграл (11) не зависит от значений $f(\tau)$ при
$\tau\neq u$, а зависит только от значения в единственной точке $f(\tau=u)$.
Поэтому функцию $f(\tau)$ можно просто заменить константой $A=f(u)=\mathrm{const}$,
которую можно будет вынести за знак интеграла:
$$A\int\limits_{-\infty}^\infty \delta(u-\tau)\mathrm{d}\tau=f(u).$$
Но теперь оставшийся интеграл равен единице (несмотря на другие переменные, это всё-равно
интеграл от дельта-функции по всему пространству) и (11) превращается
в тождество $A=f(u)$. $\blacksquare$

Возможно расчитать отклик $X(t)$ системы на некоторый входной сигнал $x(u)$ не зная
$F_t$ в явном виде, а только располагая импульсным откликом $h(t)$. Именно (используется коммутативность
свертки): $$X(t)=(x\ast h)(t)=\int\limits_{-\infty}^\infty x(t-\tau)h(\tau)\mathrm{d}\tau=
\int\limits_{-\infty}^\infty x(\tau)h(t-\tau)\mathrm{d}\tau.\eqno (12)$$

Демонстрация адекватности свертки для описания [сдвигово-инвариантных] линейный систем может быть
произведена с помощью доказательства справедливости уравнения (12).

**Набросок доказательства.**

Подстановка (10) в выражение (12) для свертки даёт:
$$(x\ast h)(t)=\int\limits_{-\infty}^\infty x(\tau) h(t-\tau)\mathrm{d}\tau=
\int\limits_{-\infty}^\infty x(\tau) F_t\delta(u-\tau)\mathrm{d}\tau.\eqno (13)$$

Используя выражаемую уравнением (7) линейность, т.е. вынося $F_t$ за знак интеграла, получаем:
$$(x\ast h)(t)=F_t\int\limits_{-\infty}^\infty x(\tau)\delta(u-\tau)\mathrm{d}\tau.$$

Применяя фильтрующее свойство (11) дельта-функции, а также определение $F_t$ как отображения
$x(u)\mapsto X(t)$, приходим к уравнению $(x\ast h)(t)=F_t x(u)=X(t)$.

Таким образом, справедливость (12) доказана. $\blacksquare$

# Заключение, выводы

Как видно из вышеприведенных примеров, свертка является достаточно естественной концепцией,
всем хорошо знакомой по умножению многозначных чисел (подходит для демонстрации линейной свертки).
Теорема о свертке тоже выглядит достаточно просто (и подходит для демонстрации циклической свертки).
Причем из обоих примеров сразу становится понятным происхождение <<необычных>> индексов в
определении свертки последовательностей (и не менее <<необычных>> аргументов у функций в непрерывном
случае).

Интересно, что корреляция, не требующая отражения графика одной из функций при наглядной интерпретации,
и могущая быть записанной без вычитания в выражениях для индексов/аргументов, оказывается даже более
отдаленной от прикладного, <<бытового>> применения математики; а аналог теоремы о свертке в случае
с корреляцией требует использования  лишней операции комплексного сопряжения.

Наконец, продемонстрирована самосогласованность операции свертки при описании достаточно большого
класса реальных систем (со свойствами линейности и сдвиговой инвариантности).

# Ссылки
- [1] <http://en.wikipedia.org/wiki/convolution>
- [2] <http://en.wikipedia.org/wiki/cross-correlation>
- [3] Jorg Arndt, Matters Computational
- [4] <http://en.wikipedia.org/wiki/Fast_Fourier_Transform>
- [5] <http://en.wikipedia.org/wiki/linear_time-invariant_system>
- [6] <http://en.wikipedia.org/wiki/Dirac_delta_function>
- [7] <http://ru.wikipedia.org/wiki/дельта-функция>
