---
layout: post
title: "Небольшая коллекция sed-скриптов."
tags: эзотерика мета программирование sed
---

# Нецелевое использование поточного редактора.

На данной странице представлен краткий аннотированный список некоторых непрактичных сценариев для
широко известного поточного редактора `sed`. В работе этой утилиты основное место занимает команда
`s/<шаблон>/<замещающий_текст>/`, ищущая и заменяющая фрагмент текста, удовлетворяющий некоторому
регулярному выражению-шаблону.

В основном, здесь представлены мои скрипты, но в конце приводится список некоторых из похожих
на них в своей непрактичности (а нередко кратно превышающих мои поделки в своей удивительности
и технологической сложности реализации) скриптов других авторов.

Сложно, а быть может уже и вовсе невозможно сказать, какие ещё необычные сценарии писались за всю
историю существования этого редактора, использовавшегося с начала/середины шестидесятых годов
прошлого века; так что остаётся лишь продолжать неспешные поиски аналогичных артефактов и, конечно,
писать свои.

Итак, моя учетная запись на GitHub содержит следующие репозитории со скриптами для `sed`:

## [ocr-in-sed](https://github.com/Circiter/ocr-in-sed)

Под впечатлением от однострочной C-программы некоего Эрика Копчинского
([Eryk Kopczynski](http://www.mimuw.edu.pl/~erykk)), написанной для небезызвестного
конкурса [ioccc](http://ioccc.org) за 2004 год и выполняющей оптическое распознавание
текста находя эйлерову характеристику его "триангуляции" (насколько
вообще можно говорить о триангуляции для картинки в стиле ASCII-арт).

Да, меня тоже сначала сбила с толку возможность распознавания на основе именно этого
топологического инварианта, очевидно имеющего одинаковые значения вообще для всех планарных
графов; поэтому интересующихся пока переадресую на статью S.B.Gray, Local Properties
of Binary Images in Two Dimensions, 1971, предположительно являющуюся основой для программы
Копчинского. По-сути, авторы расчитывают инвариант, равный разности между количеством связных
областей и количеством дырок, но расчитывают его подсчитывая различные чисто локальные конфигурации
пикселей в $2\times 2$-окне, пробегая им по всему изображению (в статье этот сверточный подход
распространен и на $3\times 3$-окна, но у Копчинского применено маленькое окно).

Увы, особая простота этой логики сильно ограничивает функциональность основанной на ней программы
распознования символов... И кроме целых из, скажем так, не очень большого промежутка $\left[8; 11\right]$ эта
OCR-программа ничего распознать толком не может.

В любом случая, я решил реализовать этот же алгоритм написав аналогичный скрипт для `sed`,
естественно вообще не стремясь к однострочности.

## [drawing-in-sed](https://github.com/Circiter/drawing-in-sed)

Простой графический редактор, выполняющий комманды со стандартного ввода и реализующий
некоторое подмножество/версию [черепашьей графики](http://en.wikipedia.org/wiki/Turtle_graphics) и
[систем Линденмайера](http://en.wikipedia.org/wiki/L-system). Сгодится для рисования 
некоторых геометрических фигур, символов, фракталов. Не самое очевидное применение `sed`,
не так ли?

## [computus-in-sed](https://github.com/Circiter/computus-in-sed)

А это почти полезный скрипт, [расчитывающий](http://ru.wikipedia.org/wiki/пасхалия) дату православной
Пасхи. Теоретически, может быть легко модифицирован для расчета дат католической, еврейской,
астрономической Пасхи.

## [langton-ant-in-sed](https://github.com/Circiter/langton-and-in-sed)

Симуляция известного автомата ["муравей Лангтона"](http://en.wikipedia.org/wiki/Langton%27s_ant),
интересного, среди прочего, своей Тьюринг-полнотой и интересной открытой проблемой, связанной с
аттракторами ("дорога" с периодом 104 шага) этой динамической системы для всех конечных конфигураций.

## [elementary-ca-in-sed](https://github.com/Circiter/elementary-ca-in-sed)

[Элементарные](http://en.wikipedia.org/wiki/elementary_cellular_automaton) одномерные конечные
автоматы по-Вольфраму.

## [life-in-sed](https://github.com/Circiter/life-in-sed)

[Игра "жизнь"](http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life) Конвея, теперь и на `sed`.

## [music-in-sed](https://github.com/Circiter/music-in-sed)

Пианино на `sed`! Кто же не делал что-то вроде `cat /dev/urandom > /dev/audio` или
`sudo cat /dev/mem > /dev/audio`? Редактор `sed` вполне может приняв со стандартного ввода
нотную запись, синтезировать последовательность символов, которая будучи отправленной в
[oss](http://www.opensound.com)-устройство `/dev/audio` (или его аналог), приводит к проигрыванию
соответствующей мелодии через звуковую карту. Всё очень просто. :)

Поводом для написания этого скрипта явилось [сообщение](http://kmkeen.com/awk-music) Kyle Keen об
этом способе генерации звука. Но там был применен полноценный язык программирования `awk`,
позволивший легко получить более качественный чем у меня звук за счет использования треугольной формы
сигнала. Так появилась музыкальная программа-синтезатор на гораздо более ограниченном `sed`, именно
в силу ограниченности и представляющем больший спортивный интерес.

## [maze-in-sed](https://github.com/Circiter/maze-in-sed)

В попытке понять написанную на `sed` одним [предположительно Сингапурским]
[хакером](https://github.com/xsot) программу поиска выхода из лабиринта я
написал свою версию, включив в комплект поставки [пока не полностью работоспособный]
комплементарный генератор лабиринтов (естественно тоже на `sed`).

## [sieve-in-sed](https://github.com/Circiter/sieve-in-sed)

[Решето Эратосфена](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes) на `sed`.

## [superpermutations-in-sed](https://github.com/Circiter/superpermutations-in-sed)

Генерация [вообще говоря, не являющихся минимальными]
[суперперестановок](http://en.wikipedia.org/wiki/superpermutation).

## [cw-in-sed](https://github.com/Circiter/cw-in-sed)

Этот скрипт принимает на вход текстовое сообщение и генерирует тональный телеграфный сигнал
(код Морзе), проигрываемый звуковой картой компьютера по принципу, описанному выше в разделе
о синтезаторе мелодий.

## [r2d2-in-sed](https://github.com/Circiter/r2d2-in-sed)

Синтезатор "речи" робота [`r2d2`](http://en.wikipedia.org/wiki/R2-D2) из вселенной "Звёздных Войн"
Д.Лукаса. Применен тот же принцип генерации текстового потока, озвучиваемого перенаправлением в
`/dev/audio`. В отличии от программы-пианино или от генератора "морзянки", здесь кроме чистых нот
(на самом деле всего-лишь прямоугольного сигнала вместо синусоиды) имеется возможность создания
белого шума, а также возможность случайного выбора нот.

Интересно, можно ли научить `r2d2` говорить [по-человечески]? Внес синтезатор речи в TODO-список. :)

--------

Кроме этого на http://gist.github.com/Circiter/ хранятся следующие "минирепозитории" (gists):

* [permutations.sed](https://gist.github.com/Circiter/ab4f8538d3882562e38a2e7525acc480) -- перестановки,
   самые обычные перестановки.
* [up-n-down.sed](https://gist.github.com/Circiter/aadaad1cc3ddce7cf13b333a65b0f78b) -- экспериментальный
   способ перемещения вверх и вниз в `sed` путем матричного транспонирования буфера редактирования.
* [transpose.sed](https://gist.github.com/Circiter/93281adfd2cdf142da5837d1dec6c770) -- транспонирование
   матрицы.
* [sliding-window.sed](https://gist.github.com/Circiter/77951d75b6b0e3b4ecc9b689e17863c3) -- другой
   подход к перемещению вверх и вниз. Последняя строка матрицы дублируется и используется как референсный
   счетчик. От текущей клетки движутся два маркера в противоположных направлениях (вправо и влево),
   на каждом шаге декрементируя референсный счётчик. Как только счётчик обнулится, мы можем утверждать,
   что один (левый) маркер находится над текущей клеткой (т.е. выше неё), правый -- под ней. Далее вокруг
   текущей клетки выделяется 8-окрестность $3\times 3$, окрашивается, отображается. И так для всех клеток с их
   последовательным обходом (слева-направо, сверху-вниз).

   Сам я последнее время использую другой подход к вертикальной навигации в `sed`, основанный на
   добавлении маркеров в начало каждой строки с последующим синхронным перемещением всех маркеров
   вправо до столкновения одного из них с текущей выбранной клеткой. В этот момент мы можем двигаться
   вверх-вниз вдоль маркеров, затем удалить их и начать работать с другой клеткой (счетчик не нужен).
   Элементарно.

<i>Nota bene,</i> я почти всегда пишу на диалекте [GNU sed](http://www.gnu.org/software/sed), что,
увы, создаёт проблемы с использованием моих `sed`-скриптов на всяких там Mac'ах, BSD'ях и этих ваших
Android'ах. Возможен ли конвертер (может быть даже написанный, о ужас, на самом `sed`) из GNU в
Posix и смогло ли бы это решить проблему портабельности? Ближайший по смыслу найденный мною
проект -- lvogel.free.fr/sed/sedcheck.sed за авторством [Laurent Vogel](http://lvogel.free.fr),
проверяющий скрипты на Posix-совместимость.

<i>Post scriptum</i>. Многие из моих `sed`-сценариев, --- ровно как и настоящий список, --- носят чисто
развлекательно-экспериментальный характер и перманентно находятся в режиме написания/дописывания;
функциональность может менятся кардинально без предварительных уведомлений и рациональных обоснований.

--------------

# Скрипты других авторов.

На страницах http://sed.sourceforge.net и http://sed.sourceforge.net/grabbag (автор: Paolo Bonzini)
можно найти неплохую коллекцию `sed`-скриптов разной степени полезности. Стоить отметить некоторые из
представленных там вещей:

* http://sed.sourceforge.net/grabbag/scripts/dc.sed -- префиксный калькулятор
   (использует обратную польскую нотацию); поддерживает арифметику, тригонометрию, корни, перевод
   между системами счисления и т.д.
* http://sed.sf.net/grabbag/tutorials/hanoi.htm -- [Ханойские башни](en.wikipedia.org/wiki/Tower_of_Hanoi).
* http://www.oocities.org/mettw/personal/software/src/sedhttpd.txt -- http-сервер на `sed`.
* http://sed.sourceforge.net/grabbag/scripts/turing.sed -- машина Тьюринга на `sed`; да,
   это -- готовое [конструктивное] доказательство вычислительной универсальности языка `sed`.
* http://sed.sourceforge.net/grabbag/scripts/sokoban.sed -- широкоизвестная игра ![i18n-sokoban](http://circiter.github.io/public/images/sokoban.png) (Sokoban, Сокобан);
   эта реализация интересна, разумеется, перемещением персонажа во всех
   направлениях (в т.ч. вверх-вниз), чего обычно на `sed` достичь не так-то просто.
* http://sed.sourceforge.net/grabbag/scripts/bf2c.sed -- транслятор из, --- ну кто
   же его не знает, --- `bf` в C.

Так же на просторах интернета были найдены:

* [sedlisp](https://github.com/shinh/sedlisp) -- написанный японцем Shinichiro Hamaji интерпретатор
   небольшого подмножества `lisp`'а.
* [bf.sed](https://github.com/stedolan/bf.sed) -- написанный [Stephen Dolan](http://stedolan.net)
   компилятор bf, генерирующий x86-код, обернутый в готовый к выполнению elf-файл [для Linux].
* [SedChess](https://github.com/bolknote/SedChess) -- шахматы, реализованные
   [Евгением Степанищевым](https://github.com/bolknote) из Казани; больше 1000 строк.
* [sedtris](https://github.com/uuner/sedtris) -- тетрис за авторством [Юлии Йомантайте](https://github.com/uuner).
* https://gist.github.com/xsot/99a8a4304660916455ba2c2c774e623a -- написанная
   Wei Heng (aka [xsot](htts://github.com/xsot)) программа решения лабиринтов (т.е. поиска пути,
   в данном случае обходом в ширину).
* http://laurent.le-brun.eu/pub/path.sed -- другой, более минималистичный, решатель лабиринтов,
   написанный [Laurent Le Brun](http://laurent.le-brun.eu).
* [`quine.sed`](https://github.com/MakeNowJust/quine/blob/master/quine.sed) из
   ["музея квинов"](https://github.com/MakeNowJust/quine) -- квин на `sed`; самостоятельно его написать
   не так-то и просто, но у его [автора](https://github.com/MakeNowJust) (см.
   http://quine.codes/) богатый опыт в квиноводстве (им были написаны квины для более чем 260
   (да, двухсот шестидесяти [или даже двухсот шестидесяти семи, кажется])
   разных языков программирования).
