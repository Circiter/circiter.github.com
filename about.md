---
layout: page
title: Справка
---

## Краткая информация

Небольшой персональный <<блог>> (публичный сетевой дневник). Тематика записей
по плану включает в себя изложение обрывочных мыслей и идей
по программированию, радиолюбительской практике, простой электронике,
и вообще занимательной науке.

Материалы оформлены с применением языка разметки [Markdown][md] (а точнее говоря, его варианта ---
kramdown+GFM) и размещены на <s>халяву</s> небезызвестном ресурсе GitHub с использованием статического
генератора [Jekyll][jekyll] в связке с функциональностью непрерывной интеграции, предоставляемой
[относительно новым] механизмом GitHub [Actions][gh-actions] (для поддержки произвольных модулей расширения ---
плагинов --- Jekyll, в частности, плагинов поддержки $\mbox{\LaTeX}$-формул, по невнятным причинам
отключенных во встроенном в GitHub Pages и работающем в безопасном режиме Jekyll-генераторе).

До этого я пытался использовать сторонние сервисы непрерывной интеграции
(CI/CD) вроде Travis CI, Circle CI и некоторые другие, но для верстки статичного блога
это кажется перебором (к тому же, web-интерфейсы Circle CI, и в особенности Travis CI,
немного не дружат с используемыми мною web-обозревателями; с API для некоторых задач, типа
создания новых проектов и привязки их к GitHub-репозиториям, пока
не разобрался).

Впрочем, настроить GitHub Actions оказалось тоже не так просто (кажется, что скудная
документация и нестабильное контр-интуитивное поведение суть не случайности, но меры
--- своеобразный фильтр --- против наплыва пользователей при ограниченных ресурсах
самого GitHub'а :) ). Вначале я пробовал размещать исходные данные (т.е., в основном,
`*.md`-файлы) в единственной на тот момент ветви `master`, в которую же и помещались
сгенерированные файлы. Это решение выглядело неплохим, но на деле выяснилось, что
даже после успешной сборки блога, сервер срабатывает неадекватно и при посещении
ассоциированных web-адресов (в данном случае, <http://circiter.github.io>
и <http://circiter.tk>) выдаётся http-ошибка 404, причем поведение сервера
при указании тех или иных конкретных страниц менялось от опыта к опыту неким
несистематичным непредсказуемым образом. Временно помогал трюк с клонированием
репозитория и отправкой пустого набора изменений (комманда `git commit` с ключем
`--allow-empty`), но и это работало лишь изредка.

Положительные изменения произошли лишь после реорганизации хранилища путем перенесения
исходных данных в новую ветвь `source`. Размещенные вне ветви `master` конфигурационные файлы
(<<workflows>>) механизма GitHub Actions оказались вполне работоспособными, заодно избавив от
необходимости применения дополнительных ухищрений, вроде удаления директории `.github` перед
инициированной конфигурационным файлом GitHub Actions отправкой сгенерированных файлов в
ветвь `master` (данный трюк был использован, --- как позже выяснилось, зря, --- во-избежание
возможных проблем с рекурсивным выполнением назначенных автоматических действий).

Но даже после этого, оставалась одна проблема с серверным хранением
актуальных версий отдаваемых пользователям-посетителям сайта/блога данных. Предположительно, серверное
кэширование приводило к невозможности некоторое время увидеть изменения в публикуемых
страницах даже после их успешной сборки. [Надёжный] способ обхода мне не известен, а может быть
пока и не существует (кроме вышеупомянутого хака с `clone`/`commit`/`push`, --- именно его-то я и
попытался применить на этом блоге, впрочем, безуспешно --- автоматизировать выполнение этой
странной операции с помощью сценария оболочки, выполняющегося при сборке всего проекта
после операции `git push origin source` мне не удалось, не исключено, что именно из-за
существования защиты от рекурсии в GitHub Actions). Впрочем, в какой-то момент, эта проблема исчезла
сама собой, без заметных причин...

Также, к репозиторию, хранящему данный блог, было подключено GitHub-приложение [TeXify][texify] (но <i>de-facto</i>
не было задействовано, в том числе по причине наличия на данный момент некоторых
проблем в генерируемых данным приложением SVG-файлах) для поддержки формул в Markdown-файлах,
просматриваемых в web-интерфейсе GitHub.

В качестве темы оформления сначала была выбрана тема [Hacker][hacker-theme], в некоторой степени из-за лицензии, но в основном
просто из-за внешнего вида. Потом я применил в качестве шаблона другую готовую Jekyll-тему [Hyde][hyde-theme],
так как Hacker с темным фоном мало совместима с печатью страниц на бумаге, в частности и в особенности
при наличии на страницах формул (иначе бы их пришлось визуализировать дважды -- с черным и с белым текстом) и
тем-более диаграмм с цветными элементами на прозрачном фоне. Естественно, пришлось внести достаточно
много мелких изменений в файлы темы оформления, в частности исправить поведение картинок (в исходных
каскадных таблицах творилось нечто мало совместимое с внутристрочными картинками-формулами).
(Для интересующихся всё-таки темой оформления Hacker, до-кучи приведу ссылку на производную тему
[hacker-blog][hacker-blog-theme].)

Так как я не использую чёткую привязку сообщений к датам, то я не стал использовать каталог
`_posts`, а создал свой (`_blog_posts`) и внес его в список коллекций в конфигурационном файле
`_config.yml`. Но на поверхность всплыли проблемы совместимости механизма Jekyll-коллекций с
метками и категориями --- если для обычных постов из папки `_posts` свойства-поля (доступные
в ruby-плагинах и liquid-разметке) `site.tags` и `site.categories` заполняются всеми имеющимися,
соответственно метками и категориями автоматически, то при использовании коллекций эти свойства
оказались пусты, что привело к необходимости правки и адаптации известных решений по работе с метками
(типа liquid-кода или плагинов для отображения облака меток). В частности, для генерации облака меток
был применен, с некоторыми изменениями, плагин `jekyll.tag-cloud.rb`, а для генерации страниц,
связанных с метками и перечисляющих соответствующие посты -- достаточно простой кусок ruby-кода,
сохраненный в файл-плагин `tags.rb`.

Плагин `font-awesome.rb`, очевидно, не нуждается в комментариях. Хотя кроме этого набора значков
(<<иконок>>) я применил (с помощью файла `_sass/svg-icons.scss` из репозитория
[jekyll-now](https://github.com/barryclark/jekyll-now))
набор
[Free-Social-Icons](https://github.com/neilorangepeel/Free-Social-Icons).

В процессе наполнения дневника случайно обнаружил, что kramdown даже при включенной поддержке GFM
(варианта Markdown, использующегося на GitHub Pages по-умолчанию, а также при отображении
Markdown-файлов в web-интерфейсе для обзора репозиториев и связанных ресурсов, типа wiki, средства
информирования об ошибках, etc.) не считает web-ссылки, не окруженные угловыми <<скобками>> `<...>`,
собственно ссылками, и не генерирует соответствующую разметку (т.е. не подсвечивает их). Однако,
и здесь сразу же нашелся маленький плагин (потребовавший минимальной модификации), решивший эту
проблему (`kramdown_easy_link.rb`).

Для поддержки формул пришлось написать отдельный простой плагин (`simplemath.rb`), производящий
верстку исходного кода формул с помощью полноценного $\mbox{\LaTeX}$-движка (из TeXLive) с
последующей конвертацией `*.dvi`-файлов либо сначала (с помощью dvips) в [encapsulated] PostScript,
а потом (с помощью ImageMagick) в PNG, либо сразу из `*.dvi` в `*.png` с помощью dvipng (в настоящий
момент, как ни странно, применен более громоздкий вариант с ImageMagick, точнее говоря, с коммандой
`convert`). При этом формулы предварительно оборачиваются в необходимый $\mbox{\LaTeX}$-код, среди прочего
содержащий комманды записи некоторых параметров формулы (а именно её типографской <<глубины>> и высоты
в пунктах) во внешний файл, содержимое которого, вместе с сообщаемой коммандой `identify` (тоже от
ImageMagick) фактической высотой изображения в пикселях, используется для более корректного
позиционирования готовых картинок на html-странице.

И хотя опытный драматург уже смог бы на основе только лишь последнего абзаца написать сценарий к
фильму ужасов, тем не менее это не конец истории. Ведь описанный конвейер работает в
Docker-контейнере! Т.е., инструкции из workflows-файла частично выполняются на ubuntu linux,
клонируется репозиторий, затем скачивается и инициализируется Docker-контейнер на основе Alpine linux,
уже в нем выполняется скрипт `build.sh`, скачивающий и устанавливающий немало вещей, включая
относительно тежеловесные ruby, bundler, jekyll, bash, git, imagemagick и т.д. После этого происходит
сборка блога, верстка и конвертация всех формул, с последующей отправкой всех сгенерированных файлов
в ветвь `master` репозитория этого блога.

Готовый Docker-контейнер включающий именно нужную комбинацию ПО найти не удалось, и хотя правильнее
было бы сделать новый контейнер, я пока обошёлся таким способом (вначале просто не предполагая, как
далеко всё зайдет). Теперь для оптимизации всего этого определенно требуется хотя-бы настроить
кэширование (естественным коррелятом эффективности которого может быть время сборки блога, измеренное
от момента отправки исходных данных в ветвь `source` до появления ожидаемых изменений на главной
странице)...

Предполагаемые процессорные и сетевые затраты выглядят несоразмерными с решаемой задачей, но ведь
многие интернет-ресурсы, включая некоторые крупные форумы, давно используют верстаемые на стороне
сервера формулы, и не исключено, что с меньшими накладными расходами; эта возможность должна стать
практически общепринятой. (К сожалению, по-факту, очень часто, слишком часто приходится сталкиваться
с клиентским рендерингом на основе какого-нибудь MathJax'а.)

Трудно не согласиться, что описанный конвейер выглядит избыточным,
но более простые решения вроде [mimeTeX][mimetex] оказались слишком ограниченными.
Впрочем, можно ещё попробовать встроенный в GitHub, но плохо документированный API-механизм
(`http://render.githubusercontent.com/render/math?math=<url_encoded_formula>`)
рендеринга формул. Странно, что эта возможность за все время своего существования не стала
стандартным способом отображения формул. (Возможно, я бы и сам воспользовался именно этим способом,
если бы была возможность извлечь базовую линию, т.е. глубину, из продуцируемых изображений.)

## Заключение

С целью предъявления читателю относительно счастливой концовки, спешу упомянуть, что блог всё-таки
заработал, с примерно сотого <<commit>>'а...

[![http://jekyllrb.com](/public/images/jekyll-logo.png)][jekyll]

Ссылки:
- [GitHub Pages](https://pages.github.com)
- [Markdown][md]
- [Jekyll][jekyll]
- [Jekyll @ GitHub](https://github.com/jekyll/jekyll)
- [Hyde][hyde-theme]
- [Hyde @ GitHub](https://github.com/poole/hyde)
- [Hacker @ GitHub][hacker-theme]
- [hacker-blog @ GitHub][hacker-blog-theme]
- [GitHub Actions][gh-actions]
- [mimeTeX][mimetex]
- [TeXify][texify]

[md]: http://daringfireball.net/projects/markdown
[jekyll]: http://jekyllrb.com
[hyde-theme]: http://hyde.getpoole.com
[hacker-theme]: https://github.com/pages-themes/hacker
[hacker-blog-theme]: https://github.com/ashishchaudhary/hacker-blog
[gh-actions]: https://github.com/features/actions
[mimetex]: http://www.forkosh.com/mimetex.html
[texify]: https://github.com/apps/texify
